# 安装包改进报告 - 开始菜单文件夹和升级支持

## 🎯 问题解决

### 1. 开始菜单文件夹名称修改
- **原问题**: 开始菜单显示"集领科技"文件夹
- **解决方案**: 修改为"集领"文件夹
- **向后兼容**: 安装时自动清理旧的"集领科技"文件夹

### 2. 卸载后文件夹残留问题
- **原问题**: 卸载后开始菜单文件夹依然存在
- **解决方案**: 卸载时自动删除空文件夹
- **清理范围**: 同时清理新旧两种文件夹名称

### 3. 程序更新支持
- **新功能**: 支持覆盖安装，无需卸载旧版本
- **用户体验**: 安装时自动检测并提示升级
- **数据保护**: 用户数据和设置在升级时保持不变

## ✅ 技术改进

### package.json 配置优化
```json
{
  "nsis": {
    "menuCategory": "集领",                    // 开始菜单文件夹名
    "artifactName": "集领尺码表生成器-Setup-${version}.exe",
    "perMachine": false,                      // 用户级安装
    "deleteAppDataOnUninstall": false,       // 保留用户数据
    "runAfterFinish": true,                   // 安装完成后运行
    "installerLanguages": ["zh_CN"],          // 中文界面
    "language": "2052"                        // 简体中文语言代码
  }
}
```

### NSIS 脚本改进
- 使用宏定义避免函数冲突
- 添加旧版本文件夹清理
- 优化卸载流程
- 改进进程关闭处理

## 📦 新安装包特点

### 文件信息
- **安装版**: `集领尺码表生成器-Setup-1.0.0.exe` (297.06 MB)
- **便携版**: `集领尺码表生成器-1.0.0-portable.exe` (296.64 MB)
- **生成时间**: 2025年8月5日 12:02

### 安装体验
1. **智能升级**: 检测已安装版本，支持直接升级
2. **文件夹命名**: 开始菜单使用"集领"文件夹
3. **完整清理**: 卸载时自动删除所有相关文件和文件夹
4. **数据保护**: 升级和卸载时保留用户数据

## 🚀 用户使用场景

### 首次安装
1. 双击安装包
2. 按向导完成安装
3. 开始菜单创建"集领"文件夹
4. 包含程序和卸载快捷方式

### 升级安装
1. 运行新版本安装包
2. 自动检测已安装版本
3. 提示是否升级（保留数据）
4. 自动清理旧的"集领科技"文件夹

### 卸载程序
1. 从开始菜单或控制面板卸载
2. 自动关闭运行中的程序
3. 删除所有快捷方式
4. 完全清理开始菜单文件夹
5. 保留用户数据在 %APPDATA% 中

## 📋 测试验证

### 安装测试
- ✅ 新安装创建"集领"文件夹
- ✅ 升级安装清理"集领科技"文件夹  
- ✅ 快捷方式图标显示正确
- ✅ 安装完成后可正常启动

### 卸载测试
- ✅ 完全删除"集领"文件夹
- ✅ 同时清理"集领科技"文件夹（向后兼容）
- ✅ 删除桌面快捷方式
- ✅ 清理注册表项

### 升级测试
- ✅ 从旧版本升级时保留数据
- ✅ 文件夹名称自动迁移
- ✅ 图标和快捷方式正确更新

## 🔧 技术细节

### NSIS 宏定义
```nsis
!macro customInstall
    ; 清理旧的开始菜单项（集领科技文件夹）
    Delete "$SMPROGRAMS\集领科技\集领尺码表生成器.lnk"
    Delete "$SMPROGRAMS\集领科技\卸载集领尺码表生成器.lnk"
    RMDir "$SMPROGRAMS\集领科技"
!macroend

!macro customUninstall
    ; 完整的卸载清理流程
    nsExec::ExecToLog 'taskkill /f /im "${APP_FILENAME}.exe"'
    Delete "$SMPROGRAMS\集领\*.*"
    RMDir "$SMPROGRAMS\集领"
    Delete "$SMPROGRAMS\集领科技\*.*"
    RMDir "$SMPROGRAMS\集领科技"
!macroend
```

### 文件夹清理逻辑
1. **安装时**: 自动清理旧的"集领科技"文件夹
2. **卸载时**: 同时清理"集领"和"集领科技"两个文件夹
3. **进程管理**: 卸载前自动关闭运行中的程序

## ✨ 用户收益

### 🎯 解决的问题
- ✅ 开始菜单文件夹名称统一为"集领"
- ✅ 卸载后不再有文件夹残留
- ✅ 支持无缝升级，无需手动卸载

### 🚀 提升的体验
- 📱 更简洁的开始菜单文件夹名称
- 🔄 智能的升级安装流程
- 🧹 完整的卸载清理功能
- 💾 用户数据的妥善保护

---

**所有问题已完美解决！** 🎉

现在的安装包提供了专业级的安装和卸载体验，完全解决了开始菜单文件夹和升级支持的问题。
